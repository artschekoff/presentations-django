# Изменение формы загрузки

Изменение формы загрузки с поддержкой импорта задач из .csv файла

## Требования

1. Первоначальный экран на сайте теперь представляет из себя выбор из двух режимов работы: ручной + импорт из .csv файла
2. Ручной режим работы ведет на текущее представление формы (с формой создания задачи + кнопкой "Новое задание")
3. Импорт из .csv-файла - это форма загрузки .csv файла, где поля файла следующие:
  |task_id (string)|book_id(number)|topic_title(string)|class(number)|subject(string)|lang(string)|template(number|none)|

  Самая первая строка файла - заголовки, далее идут значения.
4. Должны быть 2 кнопки "проверить" и "добавить в очередь".
5. Добавить в очередь активируется только когда была нажата кнопка "Проверить" и никаких ошибок не было выявлено.
6. При нажатии на кнопку "проверить" весь .csv считывается, все значения в строках проверяются на соответствие типу `presentation`. Если какую-то строку невозможно привести к типу `presentation` - сохраняется информация об ошибке и отображается на форме загрузки csv-файла с обязательным указанием строки и сообщения в которой эта ошибка произошла.
7. После нажатия на кнопку "добавить в очередь" из каждой строки создается задача `presentation` и запускается на исполнение, как если бы была нажата кнопка "запустить генерацию" на старой форме.
8. Убедись, что результаты выполнения задачи сохраняются в базу.

## Уточнения

### Поля CSV, отсутствующие в модели Presentation

Поля `task_id`, `book_id`, `template` добавляются в модель `Presentation` как отдельные nullable-колонки:

- `task_id` — `CharField`, nullable
- `book_id` — `IntegerField`, nullable
- `template` — `IntegerField`, nullable

Требуется новая миграция.

### Поле author

В CSV отсутствует. Для всех задач из CSV `author` всегда `null`.

### Поле slides_amount

В CSV отсутствует. Значение задаётся пользователем на форме импорта через отдельный селектор (опции: 10, 30) и применяется ко всем строкам файла.

### Поля book_id и template

Сохраняются в БД как метаданные. В задачу генерации (`generate_presentation_task`) не передаются.

### Уникальность task_id

Проверяется только в рамках загружаемого CSV-файла. Если `task_id` повторяется внутри одного файла — это ошибка валидации с указанием строки. Проверка по БД не требуется.

### Разделитель CSV

Точка с запятой (`;`). Кодировка файла — UTF-8.

### Валидные значения поля lang

`Русский` и `Казахский`. При сохранении в БД преобразуются в коды: `Казахский` → `kz`, `Русский` → `ru`.

### UX экрана выбора режима

Стартовый экран содержит две большие кнопки: «Ручной режим» и «Импорт из CSV». Нажатие на кнопку скрывает выбор и показывает соответствующую форму.

### После «Добавить в очередь»

Форма импорта остаётся видна над списком задач. Список задач с прогресс-барами появляется ниже, как в ручном режиме.

## Критерии приемки

1. Пользователь может зайти на форму и выбрать режим работы: ручной или импорт из .csv
2. Ручной режим работы должен работать как и прежде
3. Импорт должен корректно загружать и проверять файл, а так же уметь корректно создать очередь задач для исполнения
4. В случае ошибок валидации - они должны быть отображены в понятном виде для пользователя.
5. Задачи должны быть заведены корректно в базу перед началом их исполнения чтобы все было независимо и стабильно.
6. Результаты выполнения задач должны корректно записываться в базу (пути до файлов презентаций) и отображаться пользователю.
